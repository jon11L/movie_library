{% extends "base.html" %}

{% block content %}
{% load static %}

<br>
<br>

<div class="container-fluid my-4">
    <div class="custom-wide">
        <div class="row">
            
            
            <!-- Left section of the screen -->
            <aside class="custom-col-1-5 d-none d-md-block">
                <div></div>
            </aside>
            
            <main class="custom-col-9">

                <div class="card text-center">

                    <div class="card-header" style="display: flex; justify-content: space-between; margin: 0.2rem; padding: 0.4rem;">
                        <p></p>
                        <h4 style="margin: 0;">{{ profile.user.username.capitalize }}</h4>
                        <p style="margin: 0;"><strong>Member since: </strong>{{ profile.created_at|date:"d M Y" }}</p>
                    </div>
                
                    <!-- Main profile part: image, bio, Fav movies. -->
                    <div class="card-body">
                        <div class="row">
                        
                            <div class="col-2 card-text" style="text-align: left;">
                                <p style="margin-bottom: 0.4rem;"><strong>age: </strong><small>{{ profile.render_age }}</small></p>
                                <p style="margin-bottom: 0.1rem;"><strong>Member since: </strong><small>{{ profile.created_at|date:"d M Y" }}</small></p>
                                <p style="margin-bottom: 0rem;"><strong>Last updated: </strong><small class="text-body-secondary">{{ profile.last_update }}</small></p>
                            </div>

                            <!--  profile picture -->
                            <div class="col-2" style="margin-top: 2px; margin-right: 1rem;">
                                {% if profile.profile_picture %}
                                <img src=" {{ profile.profile_picture.url }} " class="img-fluid rounded" style="width: 200px; height: 200px;" alt="Profile photo">
                                {% else %}
                                <img src="{% static 'images/default_user_pic.png' %}" class="img-fluid rounded" style="margin: 0px 25px; width: 200px; height: 200px;" alt="Profile photo">
                                {% endif %}
                            </div>
                        
                            <div class="col-4">
                                <div style="text-align: left; margin-top: 25px; margin-bottom: 10px;">
                                    <h6 class="card-title" style="margin-bottom: 25px;">{{ profile.bio }}</h6>
                                    <!-- <p class="card-text" style="margin-bottom: 25px;">{{ profile.bio }}</p> -->
                                </div>
                            </div>

                            <div class="col">
                                <p>My Favorit movies:</p>

                                <div class="row">
                                    <!-- Create and insert top3-10 /favorit Movies of user. -->
                                    <!-- {% for movie in favorite_movies %} -->
                                    <!-- {% endfor %} -->
                                    <div class="col" style="margin-bottom: 1rem;">
                                        {% if movie.poster %}
                                        <!-- <img src="{{ movie.render_poster}}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster"> -->
                                        {% else %}
                                        <img src="{% static 'images/default_poster_photo.jpg' %}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster">
                                        {% endif %}
                                    </div>
                                    <!-- Temporary until real Top movies exist -->
                                    <div class="col" style="margin-bottom: 1rem;">
                                        {% if movie.render_poster %}
                                        <img src="{{ movie.render_poster}}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster">
                                        {% else %}
                                        <img src="{% static 'images/default_poster_photo.jpg' %}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster">
                                        {% endif %}
                                    </div>
                                    <div class="col" style="margin-bottom: 1rem;">
                                        {% if movie.render_poster %}
                                        <img src="{{ movie.render_poster}}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster">
                                        {% else %}
                                        <img src="{% static 'images/default_poster_photo.jpg' %}" class="img-fluid rounded" style="width: 120px; height: 180px;" alt="Movie poster">
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>

                    <!--  User's data, content such like watch list, liked movies -->
                    <div class="card-footer text-body-secondary d-flex space-evenly">

                        <div class="d-flex" style="margin-left: 100px; margin-right: 70px;">
                            <a href="{% url 'user_library:watch_list' request.user.id %}" class="btn btn-primary" style="background-color: rgb(75, 13, 13); padding-top: 0.5rem; padding-bottom: 0rem; border-color: black;">
                                Watchlist
                            </a>
                            <!-- clickable button to trigger if user's watchlist is private or public -->
                            <div style="margin-left: 2.5rem;">
                                {% if request.user.profile == profile %}
                                {% include "user/partials/toggle_privacy_watchlist.html" %}
                                {% endif %}
                            </div>
                        </div>
                    
                        <div class="d-flex" style="margin-left: 100px; margin-bottom: 0 ;padding-bottom: 0;">
                            {% if like %}
                            <a href="{% url 'user_library:liked_view' request.user.id %}"
                                class="btn btn-secondary"
                                style="background-color: rgb(127, 143, 231); padding-top: 0.5rem; padding-bottom: 0rem">
                                Media Liked
                            </a>
                            {% else %}
                            <a href="#" class="btn btn-secondary" style="background-color: rgb(127, 143, 231);">Media Liked </a>
                            {% endif %}
                            <p style="margin: 0.5rem 0rem 0 0.5rem;">{{ total_like }} likes</p>
                        </div>
                    
                    </div>
                </div>
                <!--  Last User's activity -->
                <div class="d-flex" style="width: 90%; justify-content: space-evenly; margin: auto;">

                    <!--  Last comments posted-->
                    <div class="col">
                        <div class="row">
                        
                            <div style="border: solid darkgrey; border-bottom: none; border-top-left-radius: 1em; border-top-right-radius: 1em; margin-top: 2em; padding-bottom: 3em;">
                            
                                <h3 style="margin-top: 2rem; margin-bottom: 1rem; text-align: center;">Last activity:</h3>

                                {% if comment_content %}
                                {% for item in comment_content|slice:"0:5" %}
                                <div class="mb-4">
                                
                                    <div class="card text-center" style="border: solid 2px darkslategray;">

                                        <div class="card-body d-flex">
                                            <p class="card-text" style="width: 95%;">{{ item.body }}</p>
                                        </div>
                                    
                                        <div class="card-footer text-body-secondary d-flex" style="justify-content: space-between;">
                                            <p></p>
                                            <div>
                                                <small>Commented on: {{ item.created_at }}</small>
                                            
                                                {% if item.kind == 'movie' %}
                                                <a href="{% url 'movie:detail' slug=item.object.slug %}" style="text-decoration: none; color: inherit;">
                                                    <span style="font-weight: bold;">| {{ item.object.title|slice:":50" }}</span>
                                                </a>
                                            
                                                {% elif item.kind == 'serie' %}
                                                <a href="{% url 'serie:detail' slug=item.object.slug %}" style="text-decoration: none; color: inherit;">
                                                    <span style="font-weight: bold;">| {{ item.object.title|slice:":50"  }}</span>
                                                </a>
                                                {% endif %}
                                            </div>
                                        
                                            <!-- delete option for Comments if user is owner of comment -->
                                            <div style="margin-top: auto;">
                                                {% if item.user.pk == request.user.pk %}
                                                <a href="{% url 'comment:delete_comment' item.user.pk %}">
                                                    <i class="fa fa-trash"></i>
                                                </a>
                                                {% endif %}
                                            </div>
                                        
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                                {% else %}
                                <br>
                                <br>
                                <h4 style="text-align: center; color: antiquewhite;">you have not posted any comments yet.</h4>
                                {% endif %}
                            
                            </div>
                        </div>
                    </div>

                    <!-- Other activities -->
                    <div class="col-sm-6" style="margin-left: 5rem;">
                        <div style="border: solid darkgrey; border-bottom: none; border-top-left-radius: 1em; border-top-right-radius: 1em; margin-top: 2rem; padding-bottom: 3rem;">
                            {% if request.user.profile == profile %}
                            <h3 style="margin-top: 2rem; margin-bottom: 2rem; text-align: center;">
                                Last added to your watchlist:
                            </h3>
                            {% else %}
                            <h3 style="margin-top: 2rem; margin-bottom: 2rem; text-align: center;"
                            >Last added to their watchlist:
                            </h3>
                            {% endif %}
                            
                            <!-- PLace here the last 3 Media liked and Watchlist as 2 boxes and link to these  -->
                            {% if last_watchlist %}
                            <div class="row" style="width: 92%; margin: auto;">
                                {% for item in last_watchlist %}
                                <div class="col-3" style="margin: auto; justify-items: center;">
                                    {% if item.kind == 'movie' %}
                                    <a href="{% url 'movie:detail' slug=item.object.slug %}">
                                        <img src="{{ item.poster }}" title="{{ item.genre}}" alt="watchlist media" class="img-fluid rounded" style="width: 120px; height: 180px;">
                                    </a>
                                    {% elif item.kind == 'serie' %}
                                    <a href="{% url 'serie:detail' slug=item.object.slug %}">
                                        <img src="{{ item.poster }}" title="{{ item.genre}}" alt="watchlist media" class="img-fluid rounded" style="width: 120px; height: 180px;">
                                    </a>
                                    {% endif  %}
                                
                                </div>
                                {% endfor %}
                            </div>
                            
                            {% endif %}
                        </div>

                        <!-- </div> -->
                    </div>
                </div>

            </main>

            <!-- Right section of the screen -->
            <aside class="custom-col-1-5 d-none d-md-block">
                <div>
                </div>
            </aside>

        </div>
    </div>
</div>

{% endblock %}